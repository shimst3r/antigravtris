pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	state={}
	state.grid=new_grid()
	state.phase="start"
end

function init_demo()
 state.score=100
 state.level=0
 state.time=0

 active_piece=new_piece(1,5,"z")
 state.active_piece=active_piece
 
 shape=random_shape("z")
 next_piece=new_piece(12,12,shape)
 state.next_piece=next_piece
 
 grid=new_grid()
 grid[12][3]=colors["grey"]
 grid[12][6]=colors["yellow"]
 grid[13][1]=colors["blue"]
 grid[13][2]=colors["grey"]
 grid[13][3]=colors["grey"]
 grid[13][6]=colors["yellow"]
 grid[13][7]=colors["yellow"]
 grid[13][9]=colors["pink"]
 grid[14][1]=colors["blue"]
 grid[14][2]=colors["grey"]
 grid[14][3]=colors["purple"]
 grid[14][4]=colors["purple"]
 grid[14][6]=colors["green"]
 grid[14][7]=colors["yellow"]
 grid[14][9]=colors["pink"]
 grid[15][1]=colors["blue"]
 grid[15][2]=colors["blue"]
 grid[15][3]=colors["purple"]
 grid[15][4]=colors["purple"]
 grid[15][5]=colors["green"]
 grid[15][6]=colors["green"]
 grid[15][7]=colors["green"]
 grid[15][8]=colors["pink"]
 grid[15][9]=colors["pink"]
 state.grid=grid
 
 state.phase="running"
end

function init_game()
 state.score=0
 state.level=0
 state.time=0

 shape=random_shape("")
 active_piece=new_piece(1,5,shape)
 state.active_piece=active_piece
 
 shape=random_shape(state.active_piece.shape)
 next_piece=new_piece(12,12,shape)
 state.next_piece=next_piece
 
 grid=new_grid()
 state.grid=grid
 
 state.phase="running"

end

function init_gameover()
 state={}
 state.grid=new_grid()
 state.phase="gameover"
end
-->8
function _update()
 if state.phase=="start" then
  if btnp(❎) then
   init_game()
  end
 elseif state.phase=="running" then
  state=update_game(state)
 elseif state.phase=="gameover" then
  state.grid=new_grid()
  if btnp(❎) then
   init_game()
  end
 end
end

function update_ap(state)
 local ap=state.active_piece
 if btnp(⬅️) then
  ap=move_left(ap,state.grid)
 elseif btnp(➡️) then
  ap=move_right(ap,state.grid)
 elseif btnp(⬇️) then
  ap=move_down(ap,state.grid)
 elseif btnp(❎) then
  candidate=rotate_clockwise(ap,state.grid)
  if can_rotate(candidate,state.grid) then
   ap=candidate
  end
 elseif btnp(🅾️) then
  ap=rotate_counterclockwise(ap,state.grid)
 else
  ap=drop(state)
 end
 return ap
end

function update_game(state)
 local _state=state
 if collision(state.active_piece,state.grid,⬇️) then
  local bottom=get_bottom_block(state.active_piece)
  local top=get_top_row(state.grid,state.active_piece.col)
  if bottom.row<=top then
   state.phase="gameover"
  else
  _state=update_pieces(state)
  end
 else
  _state.active_piece=update_ap(state)
 end
 _state.time+=1
 return _state
end

function update_pieces(state)
 local _state=state

	local active_piece=new_piece(1,5,state.next_piece.shape)
 local next_shape=random_shape(_state.next_piece.shape)
 local next_piece=new_piece(12,12,next_shape)

 _state.grid=persist(_state.active_piece,_state.grid)
 _state.active_piece=active_piece
 _state.next_piece=next_piece
 
 return _state
end
-->8
function _draw()
 cls(0)
 if state.phase=="start" then
  draw_start()
 else
  draw_ui(state)
  draw_grid(state.grid)
  draw_piece(state.next_piece)
  if state.phase=="running" then
   draw_piece(state.active_piece)
  elseif state.phase=="gameover" then
   draw_gameover()
  end
 end
end

function draw_block(row,col,sprite)
 xs=8*(col-1)
 ys=8*row
 spr(sprite,xs,ys)
end

function draw_gameover()
  for row=5,7 do
   for col=2,9 do
    draw_block(row,col,16)
   end
  end
  for row=10,11 do
   for col=3,8 do
    draw_block(row,col,16)
   end
  end
  print("press ❎ to\nplay again",2*8+2,10*8+2,6)
  draw_block(5,2,17)
  draw_block(5,3,18)
  draw_block(5,4,19)
  draw_block(5,5,20)
  draw_block(7,6,21)
  draw_block(7,7,22)
  draw_block(7,8,23)
  draw_block(7,9,24)
end

function draw_grid(grid)
 for y,row in pairs(grid) do
  for x,c in pairs(row) do
   draw_block(y,x,c)
  end
 end
end

function draw_piece(p)
 for b in all(p) do
  draw_block(b.row,b.col,colors[b.clr])
 end
end

function draw_start()
  draw_block(4,2,33)
  draw_block(4,3,34)
  draw_block(4,4,35)
  draw_block(4,5,36)
  draw_block(6,6,37)
  draw_block(6,7,38)
  draw_block(6,8,39)
  draw_block(6,9,40)
  draw_block(8,10,41)
  draw_block(8,11,42)
  draw_block(8,12,43)
  draw_block(8,13,44)
  print("press ❎ to play",3*8+2,11*8+2,6)

end


function draw_ui(state)
 print("score",88,17)
 print(state.score,88,25)

 print("level",88,41)
 print(state.level,88,49)
 
 local seconds=flr(state.time/30)
 print("time",88,65)
 print(seconds,88,73)
 
	print("next",88,89)
end

-->8
colors={
 blue=1,
 purple=2,
 green=3,
 brown=4,
 grey=5,
 yellow=6,
 pink=7,
 blank=8,
 down=9,
 up=10,
}

pieces={
 i={
  [1]=function (row,col) return {shape="i",position=1,[1]={row=row,col=col-1,clr="brown"},[2]={row=row,col=col,clr="brown"},[3]={row=row,col=col+1,clr="brown"},[4]={row=row,col=col+2,clr="brown"}} end,
  [2]=function (row,col) return {shape="i",position=2,[1]={row=row-1,col=col,clr="brown"},[2]={row=row,col=col,clr="brown"},[3]={row=row+1,col=col,clr="brown"},[4]={row=row+2,col=col,clr="brown"}} end,
 },
 o={
  [1]=function (row,col) return {shape="o",position=1,[1]={row=row,col=col-1,clr="purple"},[2]={row=row,col=col,clr="purple"},[3]={row=row+1,col=col-1,clr="purple"},[4]={row=row+1,col=col,clr="purple"}} end,
 },
 t={
  [1]=function (row,col) return {shape="t",position=1,[1]={row=row,col=col-1,clr="green"},[2]={row=row,col=col,clr="green"},[3]={row=row,col=col+1,clr="green"},[4]={row=row+1,col=col,clr="green"}} end,
  [2]=function (row,col) return {shape="t",position=2,[1]={row=row-1,col=col,clr="green"},[2]={row=row,col=col,clr="green"},[3]={row=row+1,col=col,clr="green"},[4]={row=row,col=col-1,clr="green"}} end,
  [3]=function (row,col) return {shape="t",position=3,[1]={row=row,col=col+1,clr="green"},[2]={row=row,col=col,clr="green"},[3]={row=row,col=col-1,clr="green"},[4]={row=row-1,col=col,clr="green"}} end,
  [4]=function (row,col) return {shape="t",position=4,[1]={row=row+1,col=col,clr="green"},[2]={row=row,col=col,clr="green"},[3]={row=row-1,col=col,clr="green"},[4]={row=row,col=col+1,clr="green"}} end,
 },
 j={
  [1]=function (row,col) return {shape="j",position=1,[1]={row=row,col=col-1,clr="pink"},[2]={row=row,col=col,clr="pink"},[3]={row=row,col=col+1,clr="pink"},[4]={row=row+1,col=col+1,clr="pink"}} end,  
  [2]=function (row,col) return {shape="j",position=2,[1]={row=row-1,col=col,clr="pink"},[2]={row=row,col=col,clr="pink"},[3]={row=row+1,col=col,clr="pink"},[4]={row=row+1,col=col-1,clr="pink"}} end,  
  [3]=function (row,col) return {shape="j",position=3,[1]={row=row,col=col+1,clr="pink"},[2]={row=row,col=col,clr="pink"},[3]={row=row,col=col-1,clr="pink"},[4]={row=row-1,col=col-1,clr="pink"}} end,  
  [4]=function (row,col) return {shape="j",position=4,[1]={row=row+1,col=col,clr="pink"},[2]={row=row,col=col,clr="pink"},[3]={row=row-1,col=col,clr="pink"},[4]={row=row-1,col=col+1,clr="pink"}} end,  
 },
 l={
  [1]=function (row,col) return {shape="l",position=1,[1]={row=row,col=col+1,clr="blue"},[2]={row=row,col=col,clr="blue"},[3]={row=row,col=col-1,clr="blue"},[4]={row=row+1,col=col-1,clr="blue"}} end,  
  [2]=function (row,col) return {shape="l",position=2,[1]={row=row+1,col=col,clr="blue"},[2]={row=row,col=col,clr="blue"},[3]={row=row-1,col=col,clr="blue"},[4]={row=row-1,col=col-1,clr="blue"}} end,  
  [3]=function (row,col) return {shape="l",position=3,[1]={row=row,col=col-1,clr="blue"},[2]={row=row,col=col,clr="blue"},[3]={row=row,col=col+1,clr="blue"},[4]={row=row-1,col=col+1,clr="blue"}} end,  
  [4]=function (row,col) return {shape="l",position=4,[1]={row=row-1,col=col,clr="blue"},[2]={row=row,col=col,clr="blue"},[3]={row=row+1,col=col,clr="blue"},[4]={row=row+1,col=col+1,clr="blue"}} end,  
 },
 s={
  [1]=function (row,col) return {shape="s",position=1,[1]={row=row,col=col+1,clr="yellow"},[2]={row=row,col=col,clr="yellow"},[3]={row=row+1,col=col,clr="yellow"},[4]={row=row+1,col=col-1,clr="yellow"}} end,  
  [2]=function (row,col) return {shape="s",position=2,[1]={row=row+1,col=col,clr="yellow"},[2]={row=row,col=col,clr="yellow"},[3]={row=row,col=col-1,clr="yellow"},[4]={row=row-1,col=col-1,clr="yellow"}} end,  
 },
 z={
  [1]=function (row,col) return {shape="z",position=1,[1]={row=row,col=col-1,clr="grey"},[2]={row=row,col=col,clr="grey"},[3]={row=row+1,col=col,clr="grey"},[4]={row=row+1,col=col+1,clr="grey"}} end,  
  [2]=function (row,col) return {shape="z",position=2,[1]={row=row-1,col=col,clr="grey"},[2]={row=row,col=col,clr="grey"},[3]={row=row,col=col-1,clr="grey"},[4]={row=row+1,col=col-1,clr="grey"}} end,  
 },
}

function can_rotate(piece,grid)
 for dir in all({⬆️,⬅️,➡️,⬇️}) do
  if collision(piece,grid,dir) then
   return false
  end
 end
 return true
end

function collision(piece,grid,dir)
 for b in all(piece) do
  if dir==⬅️
   and b.col>0
   and grid[b.row][b.col-1]~=colors["blank"] then
    return true
  elseif dir==➡️
   and b.col<11
   and  grid[b.row][b.col+1]~=colors["blank"] then
    return true
  elseif dir==⬇️
   and b.row==15 or grid[b.row+1][b.col]~=colors["blank"] then
    return true
  elseif dir==⬆️ and b.row<1 then
   return true
  end
 end
 return false
end

function drop(state)
 local ap=state.active_piece
 if state.time%(30-state.level)==0
  and not collision(ap,state.grid,⬇️) then
  ap=move_down(ap,state.grid)
 end
 return ap
end

function get_bottom_block(piece)
 local bottom=piece[1]
 for b in all(piece) do
  if b.row<bottom.row then
   bottom=b
  end
 end
 return bottom
end

function get_top_row(grid,col)
 for r=1,15 do
  if grid[r][col]~=colors["blank"] then
   return r
  end
 end
 return 16
end

function move_down(piece,grid)
 local bottom=get_bottom_block(piece)
 if not collision(piece,grid,⬇️) then
  for b in all(piece) do
   b.row+=1
  end
 end
 return piece
end

function move_left(piece,grid)
 if not collision(piece,grid,⬅️) then
	  for b in all(piece) do
 	  b.col-=1
 	end
 end
 return piece
end

function move_right(piece,grid)
 if not collision(piece,grid,➡️) then
  for b in all(piece) do
   b.col+=1
  end
 end
 return piece
end

function new_grid()
 grid={}
 grid[1]={}
 for j=1,10 do
  grid[1][j]=colors["down"]
 end
 for i=2,15 do
  grid[i]={}
  for j=1,10 do
   grid[i][j]=colors["blank"]
  end
 end
 return grid
end

function new_piece(row,col,shape)
 piece=pieces[shape][1](row,col)
 return piece
end

function persist(piece,grid)
 local _grid=grid
 for b in all(piece) do
  _grid[b.row][b.col]=colors[b.clr]
 end
 return _grid
end

function random_shape(curr_shape)
 repeat
  --[[
  note: generating new pieces
  should follow a well-balanced
  random distribution. the 'i'
  should be the rarest, given
  its importance for the game.
  --]] 
  new_shape=rnd({
   "i",
   "o","o",
   "t","t",
   "j","j",
   "l","l",
   "s","s","s",
   "z","z","z",
  })
 until new_shape~=curr_shape
 return new_shape
end

function rotate_clockwise(piece,grid)
 --[[
 note: offsets are based on the
 invariant block of each piece,
 which differs from shape to
 shape, but pieces have been set
 up so that piece[2] is always
 the invariant one.
 --]]
 local shp=piece.shape
 local pos=piece.position
 local row=piece[2].row
 local col=piece[2].col

 if pos==#pieces[shp] then
  pos=1
 else
  pos+=1
 end
 piece=pieces[shp][pos](row,col)
 
 return piece
end

function rotate_counterclockwise(piece,grid)
 --[[
 note: offsets are based on the
 invariant block of each piece,
 which differs from shape to
 shape, but pieces have been set
 up so that piece[2] is always
 the invariant one.
 --]]
 local shp=piece.shape
 local pos=piece.position
 local row=piece[2].row
 local col=piece[2].col

 if pos==1 then
  pos=#pieces[shp]
 else
  pos-=1
 end
 piece=pieces[shp][pos](row,col)
 
 return piece
end
__gfx__
000000000111111002222220033333300444444005555550099999900eeeeee00000000000000000000000000000000000000000000000000000000000000000
00000000177cccc1277eeee2377bbbb34774444457766665977aaaa9e77ffffe0055550000055000000550000000000000000000000000000000000000000000
007007001771c1c1277222e237733bb34779994457755665977999a9e77ffffe0500005000055000005555000000000000000000000000000000000000000000
000770001c1c1cc12e2ee2e23b3bb3b344999944565555659a9999a9effeeffe0500005000055000050550500000000000000000000000000000000000000000
000770001cc1c1c12e2ee2e23b3bb3b344999944565555659a9999a9effeeffe0500005005055050000550000000000000000000000000000000000000000000
007007001c1c1cc12e2222e23bb33bb344999944566556659a9999a9effffffe0500005000555500000550000000000000000000000000000000000000000000
000000001cccccc12eeeeee23bbbbbb344444444566666659aaaaaa9effffffe0055550000055000000550000000000000000000000000000000000000000000
000000000111111002222220033333300444444005555550099999900eeeeee00000000000000000000000000000000000000000000000000000000000000000
55555555556666556666665566666655666666555566665566556655666666556666665500000000000000000000000000000000000000000000000000000000
55555555556666556666665566666655666666555566665566556655666666556666665500000000000000000000000000000000000000000000000000000000
55555555665555556655665566556655665555556655665566556655665555556655665500000000000000000000000000000000000000000000000000000000
55555555665555556655665566556655666655556655665566556655666655556666555500000000000000000000000000000000000000000000000000000000
55555555665566556666665566556655666655556655665566556655666655556666555500000000000000000000000000000000000000000000000000000000
55555555665566556666665566556655665555556655665566556655665555556655665500000000000000000000000000000000000000000000000000000000
55555555666666556655665566556655666666556666555555665555666666556655665500000000000000000000000000000000000000000000000000000000
55555555666666556655665566556655666666556666555555665555666666556655665500000000000000000000000000000000000000000000000000000000
00000000666666006666000066666600666666000066660066666600666666006600660066666600666666006666660000666600000000000000000000000000
00000000666666006666000066666600666666000066660066666600666666006600660066666600666666006666660000666600000000000000000000000000
00000000660066006600660000660000006600006600000066006600660066006600660000660000660066000066000066000000000000000000000000000000
00000000660066006600660000660000006600006600000066660000660066006600660000660000666600000066000066666600000000000000000000000000
00000000666666006600660000660000006600006600660066660000666666006600660000660000666600000066000066666600000000000000000000000000
00000000666666006600660000660000006600006600660066006600666666006600660000660000660066000066000000006600000000000000000000000000
00000000660066006600660000660000666666006666660066006600660066000066000000660000660066006666660066660000000000000000000000000000
00000000660066006600660000660000666666006666660066006600660066000066000000660000660066006666660066660000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047744444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047799944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047744444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047799944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047744444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047799944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047744444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000047799944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044999944000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444440000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000555555000000000000000000999999000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000577666650000000000000000977aaaa900000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000577556650000000000000000977999a900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005655556500000000000000009a9999a900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005655556500000000000000009a9999a900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005665566500000000000000009a9999a900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005666666500000000000000009aaaaaa900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000555555000000000000000000999999000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111110055555500555555000000000000000000999999009999990000000000eeeeee000000000000000000000000000000000000000000000000000000000
177cccc157766665577666650000000000000000977aaaa9977aaaa900000000e77ffffe00000000000000000000000000000000000000000000000000000000
1771c1c157755665577556650000000000000000977999a9977999a900000000e77ffffe00000000000000000000000000000000000000000000000000000000
1c1c1cc1565555655655556500000000000000009a9999a99a9999a900000000effeeffe00000000000000000000000000000000000000000000000000000000
1cc1c1c1565555655655556500000000000000009a9999a99a9999a900000000effeeffe00000000000000000000000000000000000000000000000000000000
1c1c1cc1566556655665566500000000000000009a9999a99a9999a900000000effffffe00000000000000000000000000000000000000000000000000000000
1cccccc1566666655666666500000000000000009aaaaaa99aaaaaa900000000effffffe00000000000000000000000000000000000000000000000000000000
01111110055555500555555000000000000000000999999009999990000000000eeeeee000000000000000000000000000000000000000000000000000000000
01111110055555500222222002222220000000000333333009999990000000000eeeeee000000000000000000000000000000000000000000000000000000000
177cccc157766665277eeee2277eeee200000000377bbbb3977aaaa900000000e77ffffe00000000000000000000000000000000000000000000000000000000
1771c1c157755665277222e2277222e20000000037733bb3977999a900000000e77ffffe00000000000000000000000000000000000000000000000000000000
1c1c1cc1565555652e2ee2e22e2ee2e2000000003b3bb3b39a9999a900000000effeeffe00000000000000000000000000000000000000000000000000000000
1cc1c1c1565555652e2ee2e22e2ee2e2000000003b3bb3b39a9999a900000000effeeffe00000000000000000000000000000000000000000000000000000000
1c1c1cc1566556652e2222e22e2222e2000000003bb33bb39a9999a900000000effffffe00000000000000000000000000000000000000000000000000000000
1cccccc1566666652eeeeee22eeeeee2000000003bbbbbb39aaaaaa900000000effffffe00000000000000000000000000000000000000000000000000000000
01111110055555500222222002222220000000000333333009999990000000000eeeeee000000000000000000000000000000000000000000000000000000000
011111100111111002222220022222200333333003333330033333300eeeeee00eeeeee000000000000000000000000000000000000000000000000000000000
177cccc1177cccc1277eeee2277eeee2377bbbb3377bbbb3377bbbb3e77ffffee77ffffe00000000000000000000000000000000000000000000000000000000
1771c1c11771c1c1277222e2277222e237733bb337733bb337733bb3e77ffffee77ffffe00000000000000000000000000000000000000000000000000000000
1c1c1cc11c1c1cc12e2ee2e22e2ee2e23b3bb3b33b3bb3b33b3bb3b3effeeffeeffeeffe00000000000000000000000000000000000000000000000000000000
1cc1c1c11cc1c1c12e2ee2e22e2ee2e23b3bb3b33b3bb3b33b3bb3b3effeeffeeffeeffe00000000000000000000000000000000000000000000000000000000
1c1c1cc11c1c1cc12e2222e22e2222e23bb33bb33bb33bb33bb33bb3effffffeeffffffe00000000000000000000000000000000000000000000000000000000
1cccccc11cccccc12eeeeee22eeeeee23bbbbbb33bbbbbb33bbbbbb3effffffeeffffffe00000000000000000000000000000000000000000000000000000000
011111100111111002222220022222200333333003333330033333300eeeeee00eeeeee000000000000000000000000000000000000000000000000000000000

__map__
0000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
